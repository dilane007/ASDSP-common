<HTML>
<HEAD>
<TITLE>Manpage - handofft</TITLE>
</HEAD>

<BODY BGCOLOR="WHITE">

<CENTER><TABLE CELLSPACING=5 BORDER=0><TR><TD BGCOLOR="#A0A0A0" COLSPAN=2><UL>
<FONT SIZE=6 FACE="sans-serif"><B>handofft<B></FONT>
</UL></TD></TR>
<TR><TD COLSPAN=2 HEIGHT=6><FONT SIZE="-7">&nbsp;</FONT></TD></TR>

<TR><TD VALIGN="TOP"><FONT SIZE="+2">Description</FONT></TD>
<TD WIDTH=500><P>[bho,kho,offern]=handofft(b,k,g,offer,homargin)</P>
No handoff will be performed on b and k with values NaN. When base is selected an advantage is set to currently used channel by homargin [dB].</TD></TR>
<TR><TD COLSPAN=2 HEIGHT=6><FONT SIZE="-7">&nbsp;</FONT></TD></TR>

<TR><TD VALIGN="TOP"><FONT SIZE="+2">Input</FONT></TD>
<TD><TABLE BORDER=0 CELLSPACING=5 WIDTH=500><TR><TD VALIGN="TOP"><B>b</B></TD><TD>Base index for each link. Size is #links by one. Elements of b that is equal to NaN are not going to be handed off.</TD></TR>
<TR><TD VALIGN="TOP"><B>k</B></TD><TD>Channel index for each link. Size is #links by one. The value NaN indicates no hand off to this base.</TD></TR>
<TR><TD VALIGN="TOP"><B>g</B></TD><TD>Gain matrix with gain values in dB. Size is #links by #bases</TD></TR>
<TR><TD VALIGN="TOP"><B>offer</B></TD><TD>Binary matrix. Zero indicate occupied channel. Size #bases by #channels.</TD></TR>
<TR><TD VALIGN="TOP"><B>homargin</B></TD><TD>Standard deviation of the noise added to the gain matrix when base selection is made. [dB]</TD></TR>
</TABLE>
</TD></TR>
<TR><TD COLSPAN=2 HEIGHT=6><FONT SIZE="-7">&nbsp;</FONT></TD></TR>

<TR><TD VALIGN="TOP"><FONT SIZE="+2">Output</FONT></TD>
<TD><TABLE BORDER=0 CELLSPACING=5 WIDTH=500><TR><TD VALIGN="TOP"><B>bho</B></TD><TD>As b but possibly with new base stations.</TD></TR>
<TR><TD VALIGN="TOP"><B>kho</B></TD><TD>As k but possibly with new channels when handoff was possible. Otherwise the old base and channel would be kept.</TD></TR>
<TR><TD VALIGN="TOP"><B>offern</B></TD><TD>Same size as offer but with new base station- channel combination marked as occupied (zero) and the old one released (set to one).</TD></TR>
</TABLE>
</TD></TR>
<TR><TD COLSPAN=2 HEIGHT=6><FONT SIZE="-7">&nbsp;</FONT></TD></TR>

<TR><TD VALIGN="TOP"><FONT SIZE="+2">Try</FONT></TD>
<TD><PRE>[b,k,offer]=handofft(1,1,[-100 -90],[0;1],0)
 One link connected to base 1. Two bases, each with one
 channel are available. No noise is added.
[b,k,offer]=handofft(1,1,[-100 -90],[0 1;1 1],3)
 One link connected to base 1. Two bases, each with two
 channels are available. 3 dB noise is added.</PRE></TD></TR>
<TR><TD COLSPAN=2 HEIGHT=6><FONT SIZE="-7">&nbsp;</FONT></TD></TR>

<TR><TD VALIGN="TOP"><FONT SIZE="+2" COLSPAN=2>Source Code</TD></TR>
<TR><TD COLSPAN=2><PRE>function [bho, kho, offern] = handofft(b, k, g, offer, homargin)

<FONT COLOR="DARKGREEN">% by Magnus Almgren 000505</FONT>

if isempty(b)   <FONT COLOR="DARKGREEN">% the empty case</FONT>
 bho = zeros(0,1);
 kho = zeros(0,1);
 offern = offer;
 return 
end

mask = ~isnan(k)&~isnan(b); <FONT COLOR="DARKGREEN">% Do only act on already assigned channels.</FONT>
m = (1:size(g,1))'; <FONT COLOR="DARKGREEN">% make an index to each row in the gain matrix</FONT>
ind1 = <A HREF="../runetools/index.html">index</A>(m(~isnan(b))',b(~isnan(b))',size(g));
g(ind1) = g(ind1) + homargin; <FONT COLOR="DARKGREEN">% Give selected bases an advantage.</FONT>
bhot = <A HREF="../runetools/maxind.html">maxind</A>(g,[],2); <FONT COLOR="DARKGREEN">% desired bases</FONT>
nohoff = (bhot==b)|isnan(b)|isnan(k); <FONT COLOR="DARKGREEN">% No handoff on these. Keep as it is.</FONT>
[khot, offern] = <A HREF="radchanalloc.html">radchanalloc</A>(bhot, offer); <FONT COLOR="DARKGREEN">% kho is NaN where blocking occurred. </FONT>

<FONT COLOR="DARKGREEN">% set as before</FONT>
bho = b; 
kho = k; 

<FONT COLOR="DARKGREEN">% Set new base and channel where hand off was successful.</FONT>
hosucc = ~nohoff & b~=bhot & ~isnan(khot);
bho(hosucc) = bhot(hosucc); 
kho(hosucc) = khot(hosucc); 

<FONT COLOR="DARKGREEN">% Update the allocation matrix.</FONT>
offern = offer;
offern(<A HREF="../runetools/index.html">index</A>(  b(hosucc),  k(hosucc),size(offern))) = 1; <FONT COLOR="DARKGREEN">% Set free.</FONT>
offern(<A HREF="../runetools/index.html">index</A>(bho(hosucc),kho(hosucc),size(offern))) = 0; <FONT COLOR="DARKGREEN">% Set occupied.</FONT>

bho = bho(:); <FONT COLOR="DARKGREEN">% Only spanning first dimension.</FONT>
kho = kho(:);

<FONT COLOR="DARKGREEN">% $Id: handofft.m,v 1.2 2004/03/11 15:01:42 olav Exp $</FONT>
</PRE></TD></TR>
</TABLE></CENTER>
</BODY>
</HTML>