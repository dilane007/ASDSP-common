<HTML>
<HEAD>
<TITLE>Manpage - creraylangmap</TITLE>
</HEAD>

<BODY BGCOLOR="WHITE">

<CENTER><TABLE CELLSPACING=5 BORDER=0><TR><TD BGCOLOR="#A0A0A0" COLSPAN=2><UL>
<FONT SIZE=6 FACE="sans-serif"><B>creraylangmap<B></FONT>
</UL></TD></TR>
<TR><TD COLSPAN=2 HEIGHT=6><FONT SIZE="-7">&nbsp;</FONT></TD></TR>

<TR><TD VALIGN="TOP"><FONT SIZE="+2">Description</FONT></TD>
<TD WIDTH=500><P>[raylmap,sqfs]=creraylangmap(seed,angmean,angsig,N,M,rv,lambda,nlayer)</P>
Generates a raylegh fading map in two dimensions. The result can also be a stack of independent maps. Default it is assumed that sources sources are uniformly spread around a sink. See Jakes model. Also maps with non unform angular distributions can be generated.</TD></TR>
<TR><TD COLSPAN=2 HEIGHT=6><FONT SIZE="-7">&nbsp;</FONT></TD></TR>

<TR><TD VALIGN="TOP"><FONT SIZE="+2">Input</FONT></TD>
<TD><TABLE BORDER=0 CELLSPACING=5 WIDTH=500><TR><TD VALIGN="TOP"><B>seed</B></TD><TD>Seed value to the random generator. Defaults to 1</TD></TR>
<TR><TD VALIGN="TOP"><B>angmean</B></TD><TD>Angle towards the cluster od sources. Defaults to pi/2</TD></TR>
<TR><TD VALIGN="TOP"><B>angsig</B></TD><TD>Angle spread of sources. Defaults to Inf &lt;=&gt; Uniform distribution</TD></TR>
<TR><TD VALIGN="TOP"><B>N</B></TD><TD>Number of samples in the fft. Defaults to 32.</TD></TR>
<TR><TD VALIGN="TOP"><B>M</B></TD><TD>Oversampling factor in ifft. Makes the map smooth. Defaults to 16.</TD></TR>
<TR><TD VALIGN="TOP"><B>rv</B></TD><TD>Vectors that span the map. Defaults to [1 i]*N/2 wavelenths</TD></TR>
<TR><TD VALIGN="TOP"><B>lambda</B></TD><TD>Vawelength. Defaults 0.15 meter</TD></TR>
<TR><TD VALIGN="TOP"><B>nlayer</B></TD><TD>Number of independent maps. Defaults to 1</TD></TR>
</TABLE>
</TD></TR>
<TR><TD COLSPAN=2 HEIGHT=6><FONT SIZE="-7">&nbsp;</FONT></TD></TR>

<TR><TD VALIGN="TOP"><FONT SIZE="+2">Output</FONT></TD>
<TD><TABLE BORDER=0 CELLSPACING=5 WIDTH=500><TR><TD VALIGN="TOP"><B>raylmap</B></TD><TD>A complex two dimensional matrix (the map) of size N*M by N*M If nlayer is greater than 1 raylmap is three dimensional</TD></TR>
<TR><TD VALIGN="TOP"><B>sqfs</B></TD><TD>square root of the phase spectrum</TD></TR>
</TABLE>
</TD></TR>
<TR><TD COLSPAN=2 HEIGHT=6><FONT SIZE="-7">&nbsp;</FONT></TD></TR>

<TR><TD VALIGN="TOP"><FONT SIZE="+2">Try</FONT></TD>
<TD><PRE>r = creraylangmap;
mesh(-lin2db(abs(r))*2)
contour(-lin2db(abs(r))*2)
plot(r(:,1:2),'.-')
axis equal</PRE></TD></TR>
<TR><TD COLSPAN=2 HEIGHT=6><FONT SIZE="-7">&nbsp;</FONT></TD></TR>

<TR><TD VALIGN="TOP"><FONT SIZE="+2" COLSPAN=2>Source Code</TD></TR>
<TR><TD COLSPAN=2><PRE>function [raylmap, sqfs] = creraylangmap(seed,angmean,angsig,N,M,rv,lambda,nlayer)

<FONT COLOR="DARKGREEN">% by Magnus ALmgren 031027</FONT>

<FONT COLOR="DARKGREEN">%  Doppler spectrum is defined in the frequency domain given a certain speed.</FONT>
<FONT COLOR="DARKGREEN">%  The maximum observed frequency in the spectrum can be denoted as fm.</FONT>
<FONT COLOR="DARKGREEN">%  ds = sqrt(1-(f/fm)^2), abs(f)<=fm and zero otherwise </FONT>
<FONT COLOR="DARKGREEN">%  A more fundamental spectrum is achieved if the spectrum is normalized by </FONT>
<FONT COLOR="DARKGREEN">%  this speed. </FONT>
<FONT COLOR="DARKGREEN">%  The phase spectrum</FONT>
<FONT COLOR="DARKGREEN">%  fs = sqrt(1-(fi/2/pi)^2), abs(fi/2/pi)<=1 and zero otherwise </FONT>
<FONT COLOR="DARKGREEN">%  Corresponding operation is performed on the space time corellation function.</FONT>
<FONT COLOR="DARKGREEN">%  Time is in this case multiplied by the speed and will thus translate into</FONT>
<FONT COLOR="DARKGREEN">%  position.</FONT>
<FONT COLOR="DARKGREEN">%  This function is denoted space correlation function scf</FONT>
<FONT COLOR="DARKGREEN">%  scf = ifft(fs);</FONT>
<FONT COLOR="DARKGREEN">%  The resulting transform pair is now positon - phase</FONT>
<FONT COLOR="DARKGREEN">%  rather than time - frequency </FONT>
<FONT COLOR="DARKGREEN">%  In a traditional setting all sources generating the "doppler spectrum it is</FONT>
<FONT COLOR="DARKGREEN">%  assumed that the sources are spread uniformly in angle. A more elaborate model</FONT>
<FONT COLOR="DARKGREEN">%  is used in this case where the sources are spread as</FONT>
<FONT COLOR="DARKGREEN">%  afs  = exp(-(angle/2/sigma)^2) </FONT>
<FONT COLOR="DARKGREEN">%  multiplied with some normalisation constant.</FONT>
<FONT COLOR="DARKGREEN">%  The size of the side of the map is N/2 wavelengths.  </FONT>

<FONT COLOR="DARKGREEN">% Set default values to inputs if they not were present</FONT>
<A HREF="../runetools/setifnotexistorempty.html">setifnotexistorempty</A>('seed',2); <FONT COLOR="DARKGREEN">% seed for the generated map</FONT>
<A HREF="../runetools/setifnotexistorempty.html">setifnotexistorempty</A>('angmean',pi/2); <FONT COLOR="DARKGREEN">% angle towards cluster</FONT>
<A HREF="../runetools/setifnotexistorempty.html">setifnotexistorempty</A>('angsig',inf); <FONT COLOR="DARKGREEN">% angular standard deviation of sources</FONT>
<A HREF="../runetools/setifnotexistorempty.html">setifnotexistorempty</A>('N',2.^5); <FONT COLOR="DARKGREEN">%  Number of samples in phase spectrum</FONT>
<A HREF="../runetools/setifnotexistorempty.html">setifnotexistorempty</A>('M',2.^4); <FONT COLOR="DARKGREEN">% Oversampling for the ifft. Makes the map smooth</FONT>
<A HREF="../runetools/setifnotexistorempty.html">setifnotexistorempty</A>('rv','[1 exp(i*2*pi/3)]'); <FONT COLOR="DARKGREEN">% Mapsize</FONT>
<A HREF="../runetools/setifnotexistorempty.html">setifnotexistorempty</A>('lambda',0.15); <FONT COLOR="DARKGREEN">% Lambda [m]</FONT>
<A HREF="../runetools/setifnotexistorempty.html">setifnotexistorempty</A>('nlayer',2); <FONT COLOR="DARKGREEN">% Number of independent map (3rd dimension of raylmap)  </FONT>

fft2n = inline('fft(fft(s,N,1),N,2)','s','N'); <FONT COLOR="DARKGREEN">% two dimensional dft</FONT>
ifft2n = inline('ifft(ifft(s,N,1),N,2)','s','N'); <FONT COLOR="DARKGREEN">% two dimensional inverse dft</FONT>

oseed = <A HREF="../runetools/setseed.html">setseed</A>(seed); <FONT COLOR="DARKGREEN">% set seed</FONT>

<FONT COLOR="DARKGREEN">% ld2 -- Complex positions in a 2-Dim grid [-1 1 -1 1] TRY plot(ld2,'.')</FONT>
ld = linspace(-1,1,N+1);
ld2 = <A HREF="../runetools/mplus.html">mplus</A>(rv(1)*ld(2:end),rv(2)*ld(2:end)'); 

<FONT COLOR="DARKGREEN">% Normalisation of fs and afs are not necessary. Normalisation is made in</FONT>
<FONT COLOR="DARKGREEN">% the very end this routine</FONT>
<FONT COLOR="DARKGREEN">% fs -- phase spectrum from angular uniformly spread sources.</FONT>
fs = (1-abs(ld2/lambda).^2).^(-1/2); 
fs(abs(ld2)>=lambda) = 0;  

<FONT COLOR="DARKGREEN">% Angular part of the spectrum.</FONT>
afs = exp(-sqrt(2)*abs((angmean-angle(ld2))/angsig));

<FONT COLOR="DARKGREEN">% Convolute random complex spatial noise with the square root of the</FONT>
<FONT COLOR="DARKGREEN">% space correlation function. The convolution can be performed as a</FONT>
<FONT COLOR="DARKGREEN">% multiplication in the phase domain instead.</FONT>
<FONT COLOR="DARKGREEN">% fft(phase spectrun) <=> space correlation function</FONT>
<FONT COLOR="DARKGREEN">% raylmap is calculated as </FONT>
<FONT COLOR="DARKGREEN">% conv(irandn,sqrt(scf)) <=> ifft(fft(irandn).*fft(ifft(sqrt(fs.*afs)));  </FONT>
csn = <A HREF="../runetools/irandn.html">irandn</A>([size(fs) nlayer]); <FONT COLOR="DARKGREEN">% complex 3 dimensional spatial noise</FONT>
sqfs = sqrt(fs.*afs); <FONT COLOR="DARKGREEN">% Into amplitude</FONT>
raylmap = ifft2n(<A HREF="../runetools/mprod.html">mprod</A>(fft2(csn),sqfs),N*M); <FONT COLOR="DARKGREEN">% Convolute</FONT>

<FONT COLOR="DARKGREEN">% Normalize map to unit power gain</FONT>
raylmap = raylmap/std(raylmap(:)); 

<FONT COLOR="DARKGREEN">% reset seed to its original value</FONT>
<A HREF="../runetools/setseed.html">setseed</A>(oseed);

<FONT COLOR="DARKGREEN">% mesh(abs(fftshift(fft2n(sqrt(fs),N*M))))</FONT>
<FONT COLOR="DARKGREEN">% mesh(lin2db(abs(fftshift(fft2n(sqrt(fs),N*M)))))</FONT>
<FONT COLOR="DARKGREEN">% mesh(-lin2db(abs(raylmap))*2)</FONT>
<FONT COLOR="DARKGREEN">% contour(-lin2db(abs(raylmap(:,:,1)))*2)</FONT>
<FONT COLOR="DARKGREEN">% plot(raylmap(:,1:2),'.-')</FONT>
<FONT COLOR="DARKGREEN">% hist(abs(raylmap(:)),100)</FONT>
<FONT COLOR="DARKGREEN">% axis equal</FONT>
<FONT COLOR="DARKGREEN">% $Id: creraylangmap.m,v 1.2 2004/03/11 15:01:31 olav Exp $</FONT>
</PRE></TD></TR>
</TABLE></CENTER>
</BODY>
</HTML>