<HTML>
<HEAD>
<TITLE>Manpage - useraylmap</TITLE>
</HEAD>

<BODY BGCOLOR="WHITE">

<CENTER><TABLE CELLSPACING=5 BORDER=0><TR><TD BGCOLOR="#A0A0A0" COLSPAN=2><UL>
<FONT SIZE=6 FACE="sans-serif"><B>useraylmap<B></FONT>
</UL></TD></TR>
<TR><TD COLSPAN=2 HEIGHT=6><FONT SIZE="-7">&nbsp;</FONT></TD></TR>

<TR><TD VALIGN="TOP"><FONT SIZE="+2">Description</FONT></TD>
<TD WIDTH=500><P>rayl=useraylmap(pos,raylmap,raylmapvec,dim)</P>
Calculates rayleigh fading for number of positions (mobiles). If more than one map was created when the rayleigh fading was generated there will be multiple rayleigh values for each position.</TD></TR>
<TR><TD COLSPAN=2 HEIGHT=6><FONT SIZE="-7">&nbsp;</FONT></TD></TR>

<TR><TD VALIGN="TOP"><FONT SIZE="+2">Input</FONT></TD>
<TD><TABLE BORDER=0 CELLSPACING=5 WIDTH=500><TR><TD VALIGN="TOP"><B>pos</B></TD><TD>Any complex matrix containing positions which may be interpreted as absolute or relative positions in 2 dimensions. Any position is valid since wrapping into the map is performed.</TD></TR>
<TR><TD VALIGN="TOP"><B>raylmap</B></TD><TD>The body of samples within wich interpolation will be performed May consist of more than one map in which case the will be stored in third dimension. In this case the output is a cell array</TD></TR>
<TR><TD VALIGN="TOP"><B>raylmapvec</B></TD><TD>Two complex vectors spanning the area of the map. The size of the first dimension is the same as the size of the map in first and second dimension.</TD></TR>
<TR><TD VALIGN="TOP"><B>dim</B></TD><TD>The dimension in which interpolated samples from the third dimension of the maps are stored. Default is the first singleton dimension of pos.</TD></TR>
</TABLE>
</TD></TR>
<TR><TD COLSPAN=2 HEIGHT=6><FONT SIZE="-7">&nbsp;</FONT></TD></TR>

<TR><TD VALIGN="TOP"><FONT SIZE="+2">Output</FONT></TD>
<TD><TABLE BORDER=0 CELLSPACING=5 WIDTH=500><TR><TD VALIGN="TOP"><B>rayl</B></TD><TD>matrix of the same size as pos when raylmap doesn't make use of the third dimension. The values are complex and their amplitudes are rayleigh distributed. The standard deviation of the complex amplitude output rayl is 1. If raylmap makes use of the third dimension there are more than one map sample for each input position. In that case these samples are collected in dimension dim. This dimension is default selected as the fist singleton dimension of pos</TD></TR>
</TABLE>
</TD></TR>
<TR><TD COLSPAN=2 HEIGHT=6><FONT SIZE="-7">&nbsp;</FONT></TD></TR>

<TR><TD VALIGN="TOP"><FONT SIZE="+2">Try</FONT></TD>
<TD><PRE>useraylmap; % generates a plot
[raylmap, mapvec] = creraylmap([1 i]*200);
plot(lin2db(abs(useraylmap(linspace(0,irandn,1000),raylmap,mapvec))))
mean(abs(useraylmap((0:0.01:100)*irand,raylmap,mapvec).^2))</PRE></TD></TR>
<TR><TD COLSPAN=2 HEIGHT=6><FONT SIZE="-7">&nbsp;</FONT></TD></TR>

<TR><TD VALIGN="TOP"><FONT SIZE="+2">See Also</FONT></TD>
<TD><A HREF="creraylmap.html">creraylmap</A></TD></TR>
<TR><TD COLSPAN=2 HEIGHT=6><FONT SIZE="-7">&nbsp;</FONT></TD></TR>

<TR><TD VALIGN="TOP"><FONT SIZE="+2" COLSPAN=2>Source Code</TD></TR>
<TR><TD COLSPAN=2><PRE>function rayl = useraylmap(pos, raylmap, raylmapvec, dim)

<FONT COLOR="DARKGREEN">% by Magnus Almgren 031116</FONT>

if nargin == 0 <FONT COLOR="DARKGREEN">% one meter travel in random direction</FONT>
pos = 0;
end

if isempty(pos) <FONT COLOR="DARKGREEN">% empty in empty out</FONT>
 rayl = pos;
 return
end

if size(raylmapvec(:),1)<=1 <FONT COLOR="DARKGREEN">% mo map => no fading</FONT>
 rayl = ones(size(pos)); 
 return
end

if nargin < 3 <FONT COLOR="DARKGREEN">% create a map if it wasn't present</FONT>
 [raylmap, raylmapvec] = <A HREF="creraylmap.html">creraylmap</A>;
end


if nargin == 0 <FONT COLOR="DARKGREEN">% one meter travel in random direction</FONT>
 pos = (1:1000)'/1000*raylmapvec(end,1)+eps;
end

<FONT COLOR="DARKGREEN">% There might be more than one map sample for each input position.</FONT>
<FONT COLOR="DARKGREEN">% In that case these samples are collected in dimension dim. This </FONT>
<FONT COLOR="DARKGREEN">% dimension is default selected as the fist singleton dimension of pos</FONT>
<FONT COLOR="DARKGREEN">% Better is to specify that dimension as an input.</FONT>
if ~exist('dim','var')
 dim = <A HREF="../runetools/firstsing.html">firstsing</A>(pos); <FONT COLOR="DARKGREEN">% first non occupied dimension of pos</FONT>
else
 siz =size(dim);
 if siz(dim)>1
  error('Dimension dim is already in use by pos')
 end
end
rv = raylmapvec(end,:);
wpos = <A HREF="wrapinto.html">wrapinto</A>(pos,rv,'rhomb');

<FONT COLOR="DARKGREEN">% the inverse base of rv (rv(1)*base => [1 0] and rv(2)*base => [0 1] </FONT>
invbase = inv([real(rv.') imag(rv.')]);

<FONT COLOR="DARKGREEN">% the portions of v(1) and v(2) for each position element</FONT>
spos = <A HREF="../runetools/mprod.html">mprod</A>([real(wpos(:)) imag(wpos(:))]*invbase,abs(raylmapvec(end,:)));

<FONT COLOR="DARKGREEN">% wrap it  back into the interval {0,abs(rv)}</FONT>
<FONT COLOR="DARKGREEN">% shift out 3 dimensions to free space for interpolation</FONT>

pos1 = shiftdim(reshape(spos(:,1), size(pos)),-3);
pos2 = shiftdim(reshape(spos(:,2), size(pos)),-3);

<FONT COLOR="DARKGREEN">% vectors used by interp2 for table lookup </FONT>
siz = size(raylmap,1)-1;
mapi = abs(raylmapvec);

<FONT COLOR="DARKGREEN">% make position interpolation</FONT>
rayl = [];

for j = 1:size(raylmap,3)  <FONT COLOR="DARKGREEN">% store linear complex samples</FONT>
 raylj = interp2(mapi(:,1), mapi(:,2), raylmap(:,:,j).', pos1, pos2);
 rayl = cat(dim+3,rayl, raylj); 
end

<FONT COLOR="DARKGREEN">% shift back 3 dimensions to get to the dimensions of the inputs</FONT>
rayl = shiftdim(rayl,3);

if nargin == 0 <FONT COLOR="DARKGREEN">% one meter travel in random direction</FONT>
  <FONT COLOR="DARKGREEN">% contour(lin2db(abs(raylmap)*2));</FONT>
  <FONT COLOR="DARKGREEN">% hist(pos(:))</FONT>
  plot(rayl,'.-')
  <A HREF="../runetools/ploth.html">ploth</A>([rayl(end);rayl(1)],'r.-')
end

<FONT COLOR="DARKGREEN">% $Id: useraylmap.m,v 1.2 2004/03/11 15:01:31 olav Exp $</FONT>
</PRE></TD></TR>
</TABLE></CENTER>
</BODY>
</HTML>